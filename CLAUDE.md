# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Structure

This is a Claude Code, Codex, and Gemini CLI configuration repository containing:

### Configuration Directories (Source of Truth)
- **claude/**: Claude Code configuration
  - `agents/` - Agent definitions for specialized tasks
  - `commands/` - Slash commands for task processing and code management
  - `scripts/` - Helper scripts for documentation and utilities
  - `settings.local.json` - Claude Code project settings
- **gemini/**: Gemini CLI configuration
  - `commands/` - Gemini commands (TOML)
  - `GEMINI.template.md` - Gemini context template
- **codex/**: Codex configuration
  - `prompts/` - Codex prompts (includes all claude commands + codex-specific prompts)
  - `scripts/` - Shared utility scripts
  - `config.toml` - Codex configuration template
  - `mcp-servers.toml` - MCP server definitions

### Installation Scripts
- **install.sh**: Install and update configurations (auto-detects existing installations)

## Installation

Install configurations to any project using:

```bash
# Install Claude Code
bash /path/to/adn-claude-configs/install.sh --claude

# Install Gemini CLI
bash /path/to/adn-claude-configs/install.sh --gemini

# Install Codex
bash /path/to/adn-claude-configs/install.sh --codex

# Install everything
bash /path/to/adn-claude-configs/install.sh --all
```

This copies the appropriate configuration to `.claude/`, `.gemini/`, and/or `.codex/` directories.

## Updating

To sync the latest changes from this repository, simply run the install script again:

```bash
cd /path/to/your/project
bash /path/to/adn-claude-configs/install.sh --all
```

The install script auto-detects existing installations and:
- Updates agents, commands/prompts, and scripts from source directories
- Cleans up legacy directory structures (flattens nested commands, removes old file names)
- Preserves your local settings files
- Skips CLAUDE.md and CODEX.md (generated by codex)

## Custom Agents

Key specialized agents available:

- `developer`: Implements specs with tests - enforces zero linting violations
- `developer-fidelity`: Implements ONLY what's specified - no scope additions
- `quality-reviewer`: Reviews code for production failures (security, data loss, performance)
- `quality-reviewer-fidelity`: Reviews against specification requirements ONLY - prevents scope creep
- `simplify-planner`: Code cleanup specialist for complexity reduction
- `debugger`: Systematic bug analysis through evidence gathering
- `technical-writer`: Creates documentation after feature completion

## Custom Commands

Important slash commands:

### Workflow Commands
- `/prd:1:create-prd`: Create Product Requirements Documents with strict scope preservation
- `/prd:2:gen-tasks`: Convert PRDs to task lists using fidelity-preserving approach
- `/spec:1:create-spec`: Research ideas and produce specification documents
- `/spec:2:gen-tasks`: Convert specifications directly to tasks with 100% fidelity
- `/3:process-tasks`: Process task lists autonomously - executes entire phases with fidelity agents (unified for both PRD and spec workflows)

### Documentation Commands
- `/doc:fetch`: Fetch documentation for a single library/framework
- `/doc:fetch-batch`: Batch fetch documentation from markdown lists containing multiple libraries

### Code Quality Commands
- `/simplify:1:create-plan`: Generate code simplification plans using simplify-planner agent
- `/simplify:2:process-plan`: Execute existing simplification plans

### Session Management Commands
- `/cmd:create-handoff`: Create handoff document for transferring work between sessions
- `/cmd:resume-handoff`: Resume work from a handoff document
- `/cmd:research`: Research codebase area without planning commitment

### Verification Commands
- `/cmd:validate`: Post-implementation verification against plan
- `/cmd:debug`: Context-preserving investigation for debugging

### Code Review Commands
- `/cmd:local-review`: Isolated code review in separate worktree
- `/review:spec`: Multi-model specification review with inline comments (works across Claude, Gemini, Codex)
- `/review:tasks`: Multi-model task list review for accuracy against source spec (works across Claude, Gemini, Codex)
- `/review:spec-integrate`: Integrate spec review comments into the specification (Claude only)
- `/review:tasks-integrate`: Integrate task review comments by fixing inaccuracies (Claude only)

### Graduation Commands
- `/cmd:graduate`: Synthesize completed artifacts to permanent docs with codebase verification

### Git Utility Commands
- `/cmd:commit-push`: Commit all changes in the repo and push to GitHub
- `/cmd:create-pr`: Create a pull request
- `/cmd:start-linear-issue`: Start work on a Linear issue with branch management

### Other Utility Commands
- `/user:add-command`: Create new personal slash commands in ~/.claude/commands

## Configuration Notes

- Uses "sonnet" model as default
- MCP servers are pre-configured (Playwright included by default)
- Custom status line shows current directory and git branch with status
- Installation copies files (not symlinks) for independence
- Both Claude Code and Codex can be installed to the same project
- CLAUDE.md and CODEX.md are NOT installed - codex generates these files

## Thoughts Directory Structure

All working artifacts are stored in the `thoughts/` directory (committed to git):

```
thoughts/
├── plans/                    # Implementation plans, PRDs, task lists
│   ├── prd-*.md              # Product Requirements Documents
│   ├── tasks-prd-*.md        # Task lists from PRDs
│   ├── tasks-fidelity-*.md   # Task lists from specifications
│   └── simplify-plan-*.md    # Code simplification plans
├── specs/                    # Technical specifications
│   └── spec-*.md             # Research-based specifications
├── research/                 # Standalone research documents
│   └── YYYY-MM-DD-*.md       # Dated research reports
├── handoffs/                 # Session continuity documents
│   └── [TICKET]/             # Organized by ticket
│       └── YYYY-MM-DD_HH-MM-SS_description.md
├── validation/               # Post-implementation verification
│   └── YYYY-MM-DD-*.md       # Validation reports
├── debug/                    # Debug investigations
│   └── YYYY-MM-DD-*.md       # Debug reports
├── prs/                      # PR descriptions and reviews
│   └── {number}_description.md
├── linear/                   # Linear ticket notes
│   └── [ISSUE-KEY].md
└── archive/                  # Completed artifacts (from migration)
```

### Permanent Documentation

Completed features are graduated from `thoughts/` to permanent documentation:

- **spec/architecture/**: Feature architecture documents (one per feature)
- **spec/architecture/README.md**: Architecture index table
- **spec/adr-log.md**: Architectural Decision Records (ADRs)
- **CHANGELOG.md**: Running log of implemented changes

Use `/cmd:graduate [feature]` to synthesize artifacts and clean up working files.

### Migration from Legacy Directories

The install script automatically migrates legacy directories:
- `tasks/` → `thoughts/plans/` and `thoughts/specs/`
- `tasks-complete/` → `thoughts/archive/`
- `notes/linear/` → `thoughts/linear/`


## Available Documentation
- **Reactjs** (librarie): `docs/libraries/reactjs/` - 0% complete - *Updated 2025-08-31*


Fetched documentation available for enhanced Claude Code assistance:

- **Express** (framework): `docs/frameworks/express/` - 0% complete - *Updated 2025-08-31*
- **Lodash** (library): `docs/libraries/lodash/` - 0% complete - *Updated 2025-08-31*

## Important Workflow Patterns

### Task Processing Requirements

When using `/3:process-tasks`:

- Must be on a git branch other than main
- Uses fidelity-preserving agents (developer-fidelity, quality-reviewer-fidelity)
- **Processes entire phases autonomously** - no confirmation required between subtasks (use NOSUBCONF flag)
- Updates task list markdown after each subtask completion
- Test suite must pass before committing (only if tests were specified in source)
- Follow conventional commit format with descriptive messages
- Implement ONLY what's explicitly specified in source documents
- Auto-detects whether source is PRD or specification
- Stops only when: phase complete, clarification needed, or validation fails 3+ times

### Fidelity-Preserving Workflow

All commands now follow the fidelity-preserving approach:

- **Exact Implementation**: Build only features explicitly specified in source documents
- **No Scope Expansion**: Zero additions beyond explicit requirements
- **Question Ambiguities**: Ask for clarification rather than making assumptions
- **Preserve Constraints**: Maintain all limitations from source specifications
- **Fidelity Agents**: Always use developer-fidelity and quality-reviewer-fidelity for implementation

### Code Simplification Workflow

1. Use `/simplify:1:create-plan` to analyze and plan
2. Quality review with @quality-reviewer agent
3. User approval required before implementation
4. Use `/simplify:2:process-plan` for execution

### Session Handoff Workflow

For work that spans multiple sessions:

1. **Create Handoff**: Use `/cmd:create-handoff` before ending session
   - Documents current task status
   - Lists critical references and recent changes
   - Records learnings and patterns discovered
   - Specifies next steps

2. **Resume Work**: Use `/cmd:resume-handoff [ticket or path]` in new session
   - Reads handoff document
   - Verifies current state matches handoff claims
   - Presents action plan for confirmation
   - Continues work with full context

### Graduation Workflow

After completing a feature, graduate artifacts to permanent documentation:

1. **Verify Completion**: Ensure all tasks checked, tests pass
2. **Graduate**: Use `/cmd:graduate [feature]`
   - **Verifies** spec/research claims against actual codebase
   - **Reports** divergences (spec vs implementation)
   - **Documents** ACTUAL implementation state (not just what spec planned)
   - Synthesizes verified spec → spec/architecture/[feature].md
   - Synthesizes actual changes → CHANGELOG.md
   - Synthesizes verified research → spec/adr-log.md
   - Deletes working artifacts (preserved in git history)
3. **Commit**: Two commits created automatically
   - Permanent doc updates (with verification summary)
   - Artifact removal

Options: `--dry-run`, `--spec-authority`, `--confirm-each`, `--skip-verify`

### Batch Documentation Workflow

Use `/doc:fetch-batch` to process multiple libraries from README sections:

1. **Markdown Parsing**: Extracts `[Library Name](URL)` patterns from bullet points
2. **Intelligent Mapping**: Maps display names to fetchable identifiers (e.g., "Next.js 15" → `nextjs --version 15`)
3. **Batch Processing**: Calls `/doc:fetch` for each library with appropriate parameters
4. **Progress Tracking**: Reports success/failure for each library in the batch
5. **CLAUDE.md Integration**: Automatically updates documentation references

Options:
- `--dry-run`: Preview what would be fetched
- `--parallel`: Process libraries concurrently (faster)
- `--skip-existing`: Skip libraries with existing documentation
- `--file README.md --section "Dependencies"`: Extract from file section

### Quality Standards

All agents reference CLAUDE.md for:

- Project-specific quality standards
- Error handling patterns
- Testing requirements
- Build and linting commands

## MCP Server Configuration

MCP servers are pre-configured in `codex/mcp-servers.toml`:

- **Playwright**: Browser automation and testing
- **Context7**: Up-to-date library documentation fetching (used by `/doc:fetch` and spec creation)

### Context7 MCP Server

Context7 provides real-time, version-specific documentation for libraries directly into Claude's context. This avoids hallucinated APIs and outdated code patterns.

**Tools provided:**
- `resolve-library-id`: Resolves a library name to a Context7-compatible ID
- `get-library-docs`: Fetches documentation for a specific library and topic

**Usage in workflows:**
- Automatically used by `/doc:fetch` command
- Integrated into `/dev:1:create-spec` documentation discovery phase
- Can be invoked directly with "use context7" in prompts

**Requirements:** Node.js 18+

After installation, merge MCP server configurations:
- **Claude Desktop**: Add to `~/Library/Application Support/Claude/claude_desktop_config.json`
- **Codex**: Add to `~/.codex/config.toml`

## Linear Integration

This repository uses the `ltui` CLI tool for Linear integration, which provides a token-efficient, AI-friendly interface to Linear's API.

### Setup

1. **Obtain Linear API Key**
   - Go to [linear.app/settings/api](https://linear.app/settings/api)
   - Create a new Personal API Key
   - Copy the key (it won't be shown again)

2. **Configure ltui Authentication**
   ```bash
   # Add authentication profile
   ltui auth add --name default --key <your-api-key>

   # Verify authentication
   ltui auth list
   ltui teams list
   ```

3. **Test the Setup**
   ```bash
   # List your teams
   ltui teams list

   # View an issue (replace with actual issue key)
   ltui issues view <ISSUE_KEY> --format detail
   ```

### Project Alignment

For streamlined workflows, create a `.ltui.json` file in your project root:

```json
{
  "profile": "default",
  "team": "ENG",
  "project": "Doc Thingy",
  "defaultIssueState": "Todo",
  "defaultLabels": ["bug"],
  "defaultAssignee": "me"
}
```

This allows shorter commands (e.g., `ltui issues create --title "Fix"` instead of specifying team/project/labels each time).

### Common Commands

**View issue details:**
```bash
ltui issues view <ISSUE_KEY> --format detail
```

**Create an issue:**
```bash
ltui issues create \
  --team <TEAM> \
  --project "Project Name" \
  --title "Issue title" \
  --description "Description" \
  --state "Backlog" \
  --label bug
```

**Update issue state:**
```bash
ltui issues update <ISSUE_KEY> --state "In Review"
```

**Add a comment:**
```bash
ltui issues comment <ISSUE_KEY> --body "Comment text"
```

**Link a PR:**
```bash
ltui issues link <ISSUE_KEY> --url <pr-url> --title "PR #123"
```

### Migration from linear CLI / MCP

This repository previously used the `linear` CLI tool and Linear MCP server. All Linear commands have been migrated to use `ltui` for:

- **Token efficiency**: TSV format uses 50-70% fewer tokens than JSON
- **Deterministic output**: Same command always produces same format
- **AI-friendly**: Structured formats (detail, TSV) designed for parsing
- **Unified interface**: Single tool for all Linear operations

If you have the Linear MCP server configured in your global Claude Desktop config, you can remove it as it's no longer needed.

### Available ltui Commands

For full documentation, see the [ltui tool README](tools/ltui/README.md) or run:
```bash
ltui --help
ltui issues --help
```

## Maintenance

To keep installed configurations up-to-date:

1. **Update source**: Edit files in `claude/` or `codex/` directories in this repository
2. **Sync to projects**: Run `bash install.sh --all` in target projects
3. **Preserve settings**: Local settings files are never overwritten

The `claude/` and `codex/` directories are the source of truth. Changes here are distributed via the install script.
